{% extends 'base.html' %}

{% block title %}
    Project Formalization
{% endblock %}

{% block content %}
    <h1>Project: {{ project.name }}</h1>

    <form method="post">
        {% csrf_token %}
        <label for="project_name">Edit Project Name:</label>
        <input type="text" id="project_name" name="project_name" value="{{ project.name }}">
        <button type="submit" name="update_project_name">Update Name</button>
    </form>

    <h2>Defects</h2>
    <form method="post">
        {% csrf_token %}
        <input type="text" name="defect_name" placeholder="Enter defect name">
        <button type="submit" name="add_defect">Add Defect</button>
    </form>

    <!-- Табличное отображение дефектов -->
    <table border="1" cellpadding="10" cellspacing="0">
        <thead>
            <tr>
                <th>Defect Name</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for defect in defects %}
                <tr>
                    <td>{{ defect.name }}</td>
                    <td>
                        <!-- Кнопка для удаления дефекта -->
                        <form method="post" action="{% url 'delete_defect' defect.id %}" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="delete-button">Delete</button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2>Experts</h2>
    <form method="post">
        {% csrf_token %}
        <input type="text" name="expert_name" placeholder="Enter expert name">
        {% for defect in defects %}
            <label>{{ defect.name }}</label>
            <input type="number" name="rating_{{ defect.id }}" placeholder="Enter rating">
        {% endfor %}
        <button type="submit" name="add_expert">Add Expert</button>
    </form>

    <!-- Табличное отображение экспертов -->
<table border="1" cellpadding="10" cellspacing="0">
    <thead>
        <tr>
            <th>Expert Name</th>
            {% for defect in defects %}
                <th>{{ defect.name }}</th>
            {% endfor %}
            <th>Average</th>
            <th>Actions</th>
        </tr>
    </thead>
    <<tbody>
    {% for expert_data in experts_data %}
    <tr>
        <td>{{ expert_data.expert_name }}</td>
        {% for rating in expert_data.ratings %}
            <td>{% if rating %}{{ rating }}{% else %}N/A{% endif %}</td>
        {% endfor %}
        <td>{{ expert_data.average|floatformat:2 }}</td>
        <td>
            <form method="POST" action="{% url 'delete_expert' expert_id=expert_data.expert_id %}">
                {% csrf_token %}
                <button type="submit">Delete</button>
            </form>
        </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

    <!-- Add a small space below the table -->
    <div style="margin-bottom: 20px;"></div>

    <form method="post" action="{% url 'save_project' %}">
        {% csrf_token %}
        <input type="hidden" name="project_id" value="{{ project.id }}">
        <button type="submit">Save</button>
    </form>
{% endblock %}